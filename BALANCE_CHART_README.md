# BalanceChart Component

## Описание

Интерактивный анимированный компонент графика динамики баланса, построенный с использованием `@shopify/react-native-skia` и `d3-shape`.

## Возможности

### 1. Интерактивность
- **Touch Handler**: При касании экрана появляется курсор на ближайшей точке графика
- **Real-time Updates**: Значение и дата обновляются в реальном времени при движении пальца
- **Smooth Cursor**: Курсор плавно появляется и исчезает с анимацией

### 2. Плавная кривая
- Использует `d3-shape` с `curveBasis` для создания гладкой кривой Безье
- Автоматическое масштабирование данных под размер canvas
- Адаптивные отступы для лучшей визуализации

### 3. Переключение периодов
- **6 периодов**: 24ч, 1Н, 1М, 3М, 1Г, ВСЁ
- **Плавная анимация**: При смене периода график плавно появляется через `withSpring`
- **Автоматическая генерация данных**: Каждый период имеет соответствующее количество точек

### 4. Адаптивность
- Автоматическая подстройка под ширину экрана
- Поддержка темной и светлой темы
- Использование цветов из ThemeContext

### 5. Форматирование
- **Суммы**: Форматируются через CurrencyContext с учетом валюты
- **Даты**: Адаптивное форматирование в зависимости от выбранного периода
  - 24ч: 14:30
  - 1Н: Пн, 15
  - 1М/3М: 15 янв
  - 1Г/ВСЁ: янв 2025

## Использование

### Базовое использование (с моковыми данными)

```tsx
import { BalanceChart } from '../components/BalanceChart';

// В компоненте
<BalanceChart />
```

### С реальными данными

```tsx
const balanceData = [
  { date: 1234567890000, value: 10000 },
  { date: 1234567891000, value: 10500 },
  // ...
];

<BalanceChart data={balanceData} />
```

## Интеграция в AccountsScreen

Компонент заменяет `StatisticsCard`:

```tsx
// Было:
<StatisticsCard />

// Стало:
<BalanceChart />
```

Старый компонент закомментирован, чтобы можно было быстро вернуться:

```tsx
{/* <StatisticsCard /> */}
<BalanceChart />
```

## Технические детали

### Зависимости
- `react-native-svg@15.11.2` - для SVG графики (уже включен в Expo)
- `d3-shape@^3.2.0` - для создания плавных кривых
- `react-native-reanimated@~3.17.4` - для анимаций

**Примечание**: Изначально планировалось использовать `@shopify/react-native-skia`, но из-за конфликтов с React 19 был выбран `react-native-svg` как более стабильная альтернатива.

### Структура компонента

```
BalanceChart
├── Header (заголовок, значение, дата)
├── Chart Container (SVG с графиком)
│   ├── LinearGradient (градиент для линии)
│   ├── Path (линия графика)
│   ├── Circle (курсор - внешний)
│   └── Circle (курсор - внутренний)
└── Period Selector (кнопки периодов)
```

### Основные функции

#### generateMockData(period: Period): DataPoint[]
Генерирует моковые данные для выбранного периода с случайной вариацией и восходящим трендом.

#### formatDate(timestamp: number, period: Period): string
Форматирует дату в соответствии с выбранным периодом.

#### scaleX(index: number): number
Преобразует индекс точки в X координату на canvas.

#### scaleY(value: number): number
Преобразует значение баланса в Y координату на canvas.

### Анимации

1. **Курсор**: Появляется и исчезает при касании через state
2. **Смена периода**: График плавно появляется через `withSpring` с opacity
3. **Touch Feedback**: Instant feedback при движении пальца через PanResponder

### Масштабирование

Автоматическое вычисление минимума и максимума с 10% padding:

```typescript
const padding = (max - min) * 0.1 || 100;
const minVal = min - padding;
const maxVal = max + padding;
```

## Кастомизация

### Цвета
Использует цвета из `ThemeContext`:
- `colors.primary` - основной цвет линии и выбранного периода
- `colors.text` - текст
- `colors.textSecondary` - дата
- `colors.card` - фон карточки
- `colors.background` - фон неактивных кнопок

### Размеры
Можно изменить константы:
```typescript
const CHART_WIDTH = SCREEN_WIDTH - 32;  // Ширина графика
const CHART_HEIGHT = 200;               // Высота графика
const CHART_MARGIN = 20;                // Отступы
```

### Периоды
Можно добавить/удалить периоды:
```typescript
const periods: Period[] = ['24h', '1W', '1M', '3M', '1Y', 'ALL'];
```

## Будущие улучшения

- [ ] Добавить градиентную заливку под кривой
- [ ] Поддержка множественных линий (сравнение периодов)
- [ ] Вертикальные линии сетки
- [ ] Метки на осях X и Y
- [ ] Zoom и Pan жесты
- [ ] Экспорт графика в изображение
- [ ] Интеграция с реальными данными транзакций
- [ ] Кастомные tooltips при касании

## Производительность

- ✅ Мемоизация вычислений через `useMemo`
- ✅ Оптимизированный рендеринг Canvas
- ✅ Минимальные перерисовки при касаниях
- ✅ Плавные анимации через Reanimated 3

## Совместимость

- ✅ Expo SDK 53
- ✅ React Native 0.79.6
- ✅ iOS и Android
- ✅ Темная и светлая тема
- ✅ Все размеры экранов

---

**Автор**: Claude AI
**Дата создания**: 2025-10-20
**Версия**: 1.0.0
