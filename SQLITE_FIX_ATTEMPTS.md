# –ü–æ–ø—ã—Ç–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è SQLite –≤ Expo SDK 53

## –ü—Ä–æ–±–ª–µ–º–∞
`java.lang.NullPointerException` –≤ `NativeDatabase.prepareSync` –Ω–∞ Android –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ SQLite –≤ Expo SDK 51-53.

## –ß—Ç–æ –º—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏

### 1. Retry –ª–æ–≥–∏–∫–∞ (‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç)
–î–æ–±–∞–≤–∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ NullPointerException:
```javascript
while (retries > 0) {
  try {
    return this.db.getFirstSync(query, params);
  } catch (error) {
    if (error?.message?.includes('NullPointerException')) {
      retries--;
      // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–æ–º
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}
```

### 2. –û—á–µ—Ä–µ–¥—å –æ–ø–µ—Ä–∞—Ü–∏–π (üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ)
–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ SQLite:
```javascript
private static operationQueue: QueueItem[] = [];
private static async enqueueOperation<T>(operation: () => T): Promise<T> {
  return new Promise((resolve, reject) => {
    this.operationQueue.push({ operation, resolve, reject });
    this.processQueue();
  });
}
```

### 3. –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (‚úÖ –ü–æ–º–æ–≥–∞–µ—Ç)
```javascript
// –î–ª—è Android —É–≤–µ–ª–∏—á–∏–ª–∏ –∑–∞–¥–µ—Ä–∂–∫—É –¥–æ 2 —Å–µ–∫—É–Ω–¥
if (Platform.OS === 'android') {
  await new Promise(resolve => setTimeout(resolve, 2000));
}
```

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (‚úÖ –ü–æ–º–æ–≥–∞–µ—Ç)
- `safeGetFirstSync` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null –ø—Ä–∏ –æ—à–∏–±–∫–µ
- `safeGetAllSync` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ
- `safeRunSync` - –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É
- `safeExecSync` - –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É

## –¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. AsyncStorage –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
```javascript
// –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ AsyncStorage
await AsyncStorage.setItem('fallback_accounts', JSON.stringify(accounts));
await AsyncStorage.setItem('fallback_transactions', JSON.stringify(transactions));
```

### 2. SQLite –∫–∞–∫ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
```javascript
// –ü—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ SQLite, –Ω–æ –Ω–µ –ø–∞–¥–∞–µ–º –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è
try {
  if (LocalDatabaseService.isDatabaseReady()) {
    await LocalDatabaseService.createAccount(account);
  }
} catch (error) {
  console.log('SQLite –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ AsyncStorage');
}
```

### 3. –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
- –ü—Ä–∏ –≤—Ö–æ–¥–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
1. **–ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ SQLite –≤ Expo SDK 51-53**
2. **–í—Å–µ–≥–¥–∞ –∏–º–µ–π—Ç–µ fallback –Ω–∞ AsyncStorage**
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ—Ä–≤–µ—Ä–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é**

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã SQLite:
1. **AsyncStorage** - –ø—Ä–æ—Å—Ç–æ–µ key-value —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ)
2. **MMKV** - –±—ã—Å—Ç—Ä–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ AsyncStorage
3. **WatermelonDB** - —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞, –Ω–æ –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–∞
4. **Realm** - –º–æ—â–Ω–∞—è –ë–î, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏ –¥–ª—è SQLite:
1. –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –æ–ø–µ—Ä–∞—Ü–∏–π
3. –£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
4. –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ë–î –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π

## –û–∂–∏–¥–∞–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
–ü—Ä–æ–±–ª–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –≤ [expo/expo#27619](https://github.com/expo/expo/issues/27619). 
–í–æ–∑–º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ SDK 54 –∏–ª–∏ 55. 