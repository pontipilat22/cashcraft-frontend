# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å—á–µ—Ç–∞ "–ù–∞–ª–∏—á–Ω—ã–µ"

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ" –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–ª—è–ª—Å—è —Å—á–µ—Ç "–ù–∞–ª–∏—á–Ω—ã–µ" (Cash), –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ–≥–æ —É–¥–∞–ª–∏–ª.

## –ü—Ä–∏—á–∏–Ω–∞
–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ –∏ –≤ backend, –∏ –≤ frontend —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞ –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

### Backend (auth.controller.ts)
- –§—É–Ω–∫—Ü–∏—è `initializeUserData()` —Å–æ–∑–¥–∞–≤–∞–ª–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Å—á–µ—Ç "–ù–∞–ª–∏—á–Ω—ã–µ" –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–ª–∞—Å—å –≤ `resetUserData()` –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö
- –¢–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞–ª–∞—Å—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Google login

### Frontend (watermelonDatabase.ts)
- –ú–µ—Ç–æ–¥ `initDatabase()` —Å–æ–∑–¥–∞–≤–∞–ª –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Å—á–µ—Ç "–ù–∞–ª–∏—á–Ω—ã–µ" –µ—Å–ª–∏ –µ–≥–æ –Ω–µ –±—ã–ª–æ
- –ú–µ—Ç–æ–¥—ã `resetAllData()` –∏ `clearAllData()` –≤—ã–∑—ã–≤–∞–ª–∏ `initDatabase()` –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

## –†–µ—à–µ–Ω–∏–µ

### 1. Backend –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### auth.controller.ts
```typescript
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const initializeUserData = async (userId: string): Promise<void> => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∫–∞–∫–∏–µ-–ª–∏–±–æ –¥–∞–Ω–Ω—ã–µ
  const existingAccounts = await Account.count({ where: { user_id: userId } });
  const existingCategories = await Category.count({ where: { user_id: userId } });
  
  // –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–µ —Å–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ
  if (existingAccounts > 0 || existingCategories > 0) {
    console.log(`[initializeUserData] User ${userId} already has data, skipping default creation`);
    return;
  }

  // –°–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  // ...
};
```

#### –£–¥–∞–ª–µ–Ω –≤—ã–∑–æ–≤ initializeUserData –∏–∑ resetUserData
```typescript
// –ü–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –ù–ï —Å–æ–∑–¥–∞—ë–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Ä–µ—à–∏—Ç —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å
console.log(`[ResetData] Data reset completed for user: ${userId}. User can now create their own accounts and categories.`);
```

### 2. Frontend –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### watermelonDatabase.ts
```typescript
static async initDatabase(defaultCurrency: string): Promise<void> {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∫–∞–∫–∏–µ-–ª–∏–±–æ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ
  const accountsCount = await database.get<Account>('accounts').query().fetchCount();
  const categoriesCount = await database.get<Category>('categories').query().fetchCount();
  
  // –ï—Å–ª–∏ –≤ –±–∞–∑–µ —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–µ —Å–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ
  if (accountsCount > 0 || categoriesCount > 0) {
    console.log(`[WatermelonDB] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö`);
    return;
  }

  // –°–æ–∑–¥–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—É—Å—Ç–æ–π –±–∞–∑—ã
  // ...
}
```

#### –£–¥–∞–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã initDatabase –∏–∑ resetAllData –∏ clearAllData
```typescript
// –ù–ï –≤—ã–∑—ã–≤–∞–µ–º initDatabase - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Ä–µ—à–∏—Ç —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å
console.log('üîÑ [WatermelonDatabase] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω–∞, –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è');
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç
–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ":
1. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ª–æ–∫–∞–ª—å–Ω–æ
2. –î–µ—Ñ–æ–ª—Ç–Ω—ã–π —Å—á–µ—Ç "–ù–∞–ª–∏—á–Ω—ã–µ" –ù–ï —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—á–µ—Ç–∞
4. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—Ö–æ–¥–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã–µ —Å—á–µ—Ç–∞ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```bash
node test-cash-account-fix.js
```

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞
2. –°–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä–∫—É —á—Ç–æ –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤
4. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
5. –§–∏–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —á—Ç–æ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Å—á–µ—Ç

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –ø–æ–ª—É—á–∞—é—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è 